{% extends 'base.html' %}

{% block title %}Novo Agendamento - TimeSaver{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
        <div class="flex items-center justify-between mb-6">
            <h1 class="text-2xl font-bold text-gray-800">Novo Agendamento</h1>
            <a href="{{ url_for('appointments.index') }}" class="text-primary hover:text-secondary transition-colors">
                <i class="fas fa-arrow-left mr-1"></i> Voltar para Lista
            </a>
        </div>

        <form method="post" action="{{ url_for('appointments.create') }}" class="space-y-8">
            <!-- Informações Básicas -->
            <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
                <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-clock text-primary mr-2"></i>
                    Data e Hora
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="date" class="block text-sm font-medium text-gray-700 mb-1">
                            Data do Agendamento <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="far fa-calendar text-gray-400"></i>
                            </div>
                            <input type="date" id="date" name="date" required
                                class="pl-10 w-full rounded-lg border-gray-300 focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50">
                        </div>
                    </div>
                    
                    <div>
                        <label for="time" class="block text-sm font-medium text-gray-700 mb-1">
                            Horário <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="far fa-clock text-gray-400"></i>
                            </div>
                            <input type="time" id="time" name="time" required
                                class="pl-10 w-full rounded-lg border-gray-300 focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Informações do Paciente -->
            <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
                <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-user text-primary mr-2"></i>
                    Informações do Paciente
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="md:col-span-2">
                        <label for="client_name" class="block text-sm font-medium text-gray-700 mb-1">
                            Nome Completo <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="far fa-user text-gray-400"></i>
                            </div>
                            <input type="text" id="client_name" name="client_name" required
                                class="pl-10 w-full rounded-lg border-gray-300 focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50"
                                placeholder="Digite o nome completo do paciente">
                        </div>
                    </div>

                    {% if 'client_phone' in columns %}
                    <div>
                        <label for="client_phone" class="block text-sm font-medium text-gray-700 mb-1">
                            Telefone
                        </label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fas fa-phone text-gray-400"></i>
                            </div>
                            <input type="tel" id="client_phone" name="client_phone"
                                class="pl-10 w-full rounded-lg border-gray-300 focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50"
                                placeholder="(00) 00000-0000">
                        </div>
                    </div>
                    {% endif %}

                    {% if 'client_email' in columns %}
                    <div>
                        <label for="client_email" class="block text-sm font-medium text-gray-700 mb-1">
                            E-mail
                        </label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="far fa-envelope text-gray-400"></i>
                            </div>
                            <input type="email" id="client_email" name="client_email"
                                class="pl-10 w-full rounded-lg border-gray-300 focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50"
                                placeholder="email@exemplo.com">
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Informações do Serviço -->
            <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
                <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-clipboard-list text-primary mr-2"></i>
                    Informações do Serviço
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="md:col-span-2">
                        <label for="service" class="block text-sm font-medium text-gray-700 mb-1">
                            Procedimento/Serviço <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fas fa-briefcase-medical text-gray-400"></i>
                            </div>
                            <input type="text" id="service" name="service" required
                                class="pl-10 w-full rounded-lg border-gray-300 focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50"
                                placeholder="Digite o nome do procedimento ou serviço">
                        </div>
                    </div>

                    {% if 'insurance' in columns %}
                    <div>
                        <label for="insurance" class="block text-sm font-medium text-gray-700 mb-1">
                            Convênio
                        </label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fas fa-id-card text-gray-400"></i>
                            </div>
                            <select id="insurance" name="insurance"
                                class="pl-10 w-full rounded-lg border-gray-300 focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50">
                                <option value="">Particular</option>
                                <option value="Unimed">Unimed</option>
                                <option value="Amil">Amil</option>
                                <option value="SulAmérica">SulAmérica</option>
                                <option value="Bradesco Saúde">Bradesco Saúde</option>
                                <option value="Notre Dame">Notre Dame</option>
                            </select>
                        </div>
                    </div>
                    {% endif %}

                    {% if 'tuss_code' in columns %}
                    <div>
                        <label for="tuss_code" class="block text-sm font-medium text-gray-700 mb-1">
                            Código TUSS
                        </label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fas fa-hashtag text-gray-400"></i>
                            </div>
                            <input type="text" id="tuss_code" name="tuss_code"
                                class="pl-10 w-full rounded-lg border-gray-300 focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50"
                                placeholder="Digite o código TUSS">
                        </div>
                    </div>
                    {% endif %}

                    {% if 'doctor' in columns %}
                    <div>
                        <label for="doctor" class="block text-sm font-medium text-gray-700 mb-1">
                            Médico Responsável
                        </label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fas fa-user-md text-gray-400"></i>
                            </div>
                            <input type="text" id="doctor" name="doctor"
                                class="pl-10 w-full rounded-lg border-gray-300 focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50"
                                placeholder="Nome do médico responsável">
                        </div>
                    </div>
                    {% endif %}

                    {% if 'status' in columns %}
                    <div>
                        <label for="status" class="block text-sm font-medium text-gray-700 mb-1">
                            Status
                        </label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fas fa-tasks text-gray-400"></i>
                            </div>
                            <select id="status" name="status"
                                class="pl-10 w-full rounded-lg border-gray-300 focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50">
                                <option value="agendado">Agendado</option>
                                <option value="confirmado">Confirmado</option>
                                <option value="realizado">Realizado</option>
                                <option value="cancelado">Cancelado</option>
                            </select>
                        </div>
                    </div>
                    {% endif %}

                    {% if 'notes' in columns %}
                    <div class="md:col-span-2">
                        <label for="notes" class="block text-sm font-medium text-gray-700 mb-1">
                            Observações
                        </label>
                        <div class="relative">
                            <div class="absolute top-3 left-3 pointer-events-none">
                                <i class="far fa-sticky-note text-gray-400"></i>
                            </div>
                            <textarea id="notes" name="notes" rows="3"
                                class="pl-10 w-full rounded-lg border-gray-300 focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50"
                                placeholder="Informações adicionais importantes"></textarea>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>

            <div class="flex justify-end space-x-4">
                <a href="{{ url_for('appointments.index') }}" 
                    class="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition-colors">
                    Cancelar
                </a>
                <button type="submit" 
                    class="px-6 py-3 bg-primary hover:bg-secondary text-white rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition-colors">
                    <i class="fas fa-check mr-2"></i>Criar Agendamento
                </button>
            </div>
        </form>
    </div>
</div>

{% block scripts %}
<script>
    // Define a data mínima como hoje
    const dateInput = document.getElementById('date');
    const today = new Date().toISOString().split('T')[0];
    dateInput.min = today;
    dateInput.value = today;

    // Máscara para telefone
    const phoneInput = document.getElementById('client_phone');
    if (phoneInput) {
        phoneInput.addEventListener('input', function (e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 11) {
                if (value.length <= 2) {
                    value = value;
                } else if (value.length <= 7) {
                    value = `(${value.slice(0,2)}) ${value.slice(2)}`;
                } else {
                    value = `(${value.slice(0,2)}) ${value.slice(2,7)}-${value.slice(7)}`;
                }
                e.target.value = value;
            }
        });
    }
</script>
{% endblock %}
{% endblock %} 